# 跨域认证

Authok 强烈推荐通过 全局登录来进行认证事务，因为这是最简单且最安全的方式.

## 什么是跨域认证

当认证请求通过应用发起(通过 Lock Widget 或 自定义的登录表单)到 Authok, 用户凭证(credentials)被发送到另外的 domain. 从一个源收集用户凭证然后发送到另一个源会带来一些安全隐患，包括网络钓鱼攻击.

Authok 提供了一个采用第三方 cookie 的跨域认证流程. 使用第三方 Cookie 允许 Lock 和 Authok 的后端执行必要的检查，以允许跨不同来源的安全身份验证事务检查. 这避免了在应用中使用 Lock 或 自定义表单实现单点登录时发生钓鱼攻击.

不建议进行跨源身份验证，只有在使用用户名和密码对目录进行身份验证时才需要进行跨源身份验证. 社交身份提供者和企业联盟使用不同的机制，通过 OpenID Connect 和 SAML 等标准协议重定向. 此外，跨源身份验证仅适用于 web 上的嵌入式登录（使用 Lock 或 authok.js）。使用嵌入式登录的本机应用程序使用标准 OAuth 2.0 令牌端点。

# 局限

由于跨源身份验证是使用第三方 cookie 实现的，因此禁用第三方 cookie 将导致跨源身份验证失败。某些浏览器，例如最新版本的 Firefox，默认情况下禁用第三方 cookie，这意味着 Firefox 上的用户无法进行跨源身份验证。让 Firefox 用户使用嵌入式登录的唯一方法是使用自定义域名，如下所述。
有两种方法可以解决此问题：

- 在租户上启用自定义域，并在与 Authok 自定义域具有相同顶级域的域中托管 web 应用程序。例如，您在以下位置托管应用程序：https://northwind.com 并将 Authok 自定义域设置为https://login.northwind.com. 这样，Cookie 不再是第三方（因为 Authok 租户和应用程序都使用同一顶级域），因此不会被浏览器阻止。
- 创建并链接一个跨源验证页面，该页面将使跨源验证在有限数量的浏览器中工作，即使禁用了第三方 cookie。
